<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</title>

<!-- Ù…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ -->
<script>
if (!localStorage.getItem("authToken")) {
    window.location.href = "login.html";
}
</script>

<style>
    body {
        font-family: 'Cairo', sans-serif;
        margin: 0;
        padding: 20px;
        transition: 0.3s;
    }

    body.light {
        background: #f2f2f2;
        color: #000;
    }
    body.dark {
        background: #1a1a1a;
        color: #fff;
    }

    .container {
        max-width: 600px;
        margin: auto;
        background: rgba(255,255,255,0.10);
        padding: 20px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
    }

    .input, textarea {
        width: 95%;
        padding: 12px;
        margin-bottom: 15px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
    }

    textarea {
        height: 130px;
        resize: none;
    }

    .send-btn {
        width: 100%;
        padding: 14px;
        background: #2196F3;
        color: #fff;
        border: none;
        border-radius: 10px;
        font-size: 17px;
        cursor: pointer;
    }

    .mode-btn {
        width: 100%;
        padding: 10px 15px;
        border: none;
        border-radius: 10px;
        margin-bottom: 15px;
        background: #444;
        color: white;
        cursor: pointer;
    }

    .logout {
        margin-top: 20px;
        width: 100%;
        padding: 12px;
        background: crimson;
        color: #fff;
        border: none;
        border-radius: 10px;
        cursor: pointer;
    }

    #leaderMsgBox {
      background:#ffffff15;
      padding:15px;
      border-radius:10px;
      margin-bottom:20px;
      font-size:17px;
    }

    @media(max-width: 500px){
        .container { padding: 15px; }
    }
</style>
</head>

<body class="dark">

<h2 id="welcome"></h2>

<div class="container">

    <div id="leaderMsgBox">
        ğŸ“© <span id="leaderMsg">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠÙ… Ù„ÙŠØ¯Ø±...</span>
    </div>

    <button class="mode-btn" onclick="toggleMode()">ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ¶Ø¹ (Ù†Ù‡Ø§Ø± / Ù„ÙŠÙ„)</button>

    <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</h2>

    <input type="text" id="userid" class="input" readonly>
    <input type="text" id="name" class="input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù">
    <input type="text" id="caseNumber" class="input" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙƒÙŠØ³ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
    <textarea id="issue" placeholder="Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¨Ø§Ù„ØªÙØµÙŠÙ„..."></textarea>

    <button class="send-btn" onclick="sendToSheet()">Ø¥Ø±Ø³Ø§Ù„</button>
    <p id="sendStatus" style="margin-top:10px; font-weight:bold;"></p>

    <button class="logout" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<script>
// Ø¶Ø¹ Ù†ÙØ³ firebaseConfig ÙÙŠ leader.html Ø¨Ø§Ù„Ø¶Ø¨Ø·
const firebaseConfig = {
  apiKey: "AIzaSyCmLgutb7UDoClccCwBgXcM7Ua12Wjzwic",
  authDomain: "haztl-148bb.firebaseapp.com",
  databaseURL: "https://haztl-148bb-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "haztl-148bb",
  storageBucket: "haztl-148bb.firebasestorage.app",
  messagingSenderId: "1071555434114",
  appId: "1:1071555434114:web:a8aca47afe340e3bad469b"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function typeWriter(text, element, speed = 70) {
    let i = 0;
    function typing() {
        if (i < text.length) {
            element.textContent += text.charAt(i);
            i++;
            setTimeout(typing, speed);
        }
    }
    typing();
}

function loadLeaderMessageRealtime() {
    const name = localStorage.getItem("userName");
    const span = document.getElementById("leaderMsg");

    db.ref("leaderMessages/" + name).on("value", snap => {
        const data = snap.val();
        if (data && data.message) {
            span.textContent = data.message;
        } else {
            span.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.";
        }
    });
}


// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheet
function sendToSheet() {
    const status = document.getElementById("sendStatus");

    status.style.color = "#ffd700";
    status.textContent = "â³ ÙŠØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¢Ù†...";

    const payload = {
        user: document.getElementById("userid").value,
        name: document.getElementById("name").value,
        caseNumber: document.getElementById("caseNumber").value,
        issue: document.getElementById("issue").value
    };

    fetch("YOUR_GOOGLE_SCRIPT_URL_HERE", {
        method: "POST",
        body: JSON.stringify(payload)
    })
    .then(() => {
        status.style.color = "#3cff00";
        status.textContent = "âœ” ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­";
    })
    .catch(() => {
        status.style.color = "red";
        status.textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„";
    });
}

function toggleMode() {
    document.body.classList.toggle("dark");
    document.body.classList.toggle("light");
    localStorage.setItem("mode", document.body.className);
}

function logout() {
    localStorage.removeItem("authToken");
    localStorage.removeItem("userID");
    localStorage.removeItem("userName");
    window.location.href = "login.html";
}

window.onload = () => {
    const saved = localStorage.getItem("mode");
    if (saved) document.body.className = saved;

    document.getElementById("userid").value = localStorage.getItem("userID") || "";

    const name = localStorage.getItem("userName") || "Ù…Ø³ØªØ®Ø¯Ù…";
    const welcome = document.getElementById("welcome");
    typeWriter("Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙŠØ§ " + name + " ğŸ‘‹", welcome);

    loadLeaderMessage();
};
</script>

</body>
</html>
