<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</title>

<!-- Ù…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„ -->
<script>
if (!localStorage.getItem("authToken")) {
    window.location.href = "login.html";
}
</script>

<style>
    body {
        font-family: 'Cairo', sans-serif;
        margin: 0;
        padding: 20px;
        transition: 0.3s;
    }

    body.light {
        background: #f2f2f2;
        color: #000;
    }
    body.dark {
        background: #1a1a1a;
        color: #fff;
    }

    .container {
        max-width: 600px;
        margin: auto;
        background: rgba(255,255,255,0.10);
        padding: 20px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
    }

    .input, textarea {
        width: 95%;
        padding: 12px;
        margin-bottom: 15px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
    }

    textarea {
        height: 130px;
        resize: none;
    }

    .send-btn {
        width: 100%;
        padding: 14px;
        background: #2196F3;
        color: #fff;
        border: none;
        border-radius: 10px;
        font-size: 17px;
        cursor: pointer;
    }

    .mode-btn {
        width: 100%;
        padding: 10px 15px;
        border: none;
        border-radius: 10px;
        margin-bottom: 15px;
        background: #444;
        color: white;
        cursor: pointer;
    }

    .logout {
        margin-top: 20px;
        width: 100%;
        padding: 12px;
        background: crimson;
        color: #fff;
        border: none;
        border-radius: 10px;
        cursor: pointer;
    }

    @media(max-width: 500px){
        .container { padding: 15px; }
    }
</style>
</head>

<h2 id="welcome"></h2>

<body class="dark">

<div class="container">



    <button class="mode-btn" onclick="toggleMode()">ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ¶Ø¹ (Ù†Ù‡Ø§Ø± / Ù„ÙŠÙ„)</button>

    <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</h2>

    <input type="text" id="userid" class="input" readonly>
    <input type="text" id="name" class="input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù">
    <input type="text" id="caseNumber" class="input" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙƒÙŠØ³ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
    <textarea id="issue" placeholder="Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¨Ø§Ù„ØªÙØµÙŠÙ„..."></textarea>

    <button class="send-btn" onclick="sendToSheet()">Ø¥Ø±Ø³Ø§Ù„</button>

    <button class="logout" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<script>
    function typeWriter(text, element, speed = 70) {
    let i = 0;
    function typing() {
        if (i < text.length) {
            element.textContent += text.charAt(i);
            i++;
            setTimeout(typing, speed);
        }
    }
    typing();
}

// Ø¹Ø±Ø¶ Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠ
document.getElementById("userid").value = localStorage.getItem("userID");

// ØªØºÙŠÙŠØ± Ø§Ù„ÙˆØ¶Ø¹ (Ù†Ù‡Ø§Ø±/Ù„ÙŠÙ„)
function toggleMode() {
    document.body.classList.toggle("dark");
    document.body.classList.toggle("light");
    localStorage.setItem("mode", document.body.className);
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸
window.onload = () => {
    // Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸
    const saved = localStorage.getItem("mode");
    if (saved) document.body.className = saved;

    // Ø¹Ø±Ø¶ Ø±Ù‚Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    document.getElementById("userid").value = localStorage.getItem("userID");

    // Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³Ù… Ø¨Ø­Ø±ÙƒØ© ÙƒØªØ§Ø¨Ø©
    const name = localStorage.getItem("userName");
    const welcome = document.getElementById("welcome");
    const msg = "Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙŠØ§ " + name + " ğŸ‘‹";
    typeWriter(msg, welcome);

    startAutoLogoutTimer(); // â† Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
};


// Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Sheet
function sendToSheet() {
    const payload = {
        user: document.getElementById("userid").value,
        name: document.getElementById("name").value,
        caseNumber: document.getElementById("caseNumber").value,
        issue: document.getElementById("issue").value
    };

    fetch("https://script.google.com/macros/s/AKfycbxFYL-1X3YNNXGm5oRa-Eifyqbddrl-biEtdGl3458DexmSydUN0nmmiF3zh8IDWNX2/exec", {
        method: "POST",
        body: JSON.stringify(payload)
    })
    .then(() => alert("âœ” ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­"))
    .catch(() => alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„"));
}

// Ø®Ø±ÙˆØ¬
function logout() {
    localStorage.removeItem("authToken");
    localStorage.removeItem("userID");
    window.location.href = "login.html";
}

let logoutTimer;

function resetTimer() {
    clearTimeout(logoutTimer);
    logoutTimer = setTimeout(() => {
        alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§Ù„Ù†Ø´Ø§Ø·.");
        logout();
    }, 180000); // 180,000 = 3 Ø¯Ù‚Ø§Ø¦Ù‚
}

function startAutoLogoutTimer() {
    resetTimer();

    window.onmousemove = resetTimer;
    window.onkeydown = resetTimer;
    window.onclick = resetTimer;
    window.onscroll = resetTimer;
}
</script>

</body>
</html>
